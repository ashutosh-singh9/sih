<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeTable Genius - AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, #d6a7ff 0%,#9088ff 30% ,#000000 100%);
        }
        .sidebar {
            background: linear-gradient(180deg, #5d00ae 0%,#0f0067 50% ,#000000 100%);
        }
        .chat-message {
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 12px;
            max-width: 75%;
            word-wrap: break-word;
            line-height: 1.5;
        }
        .user-message {
            background-color: #6d28d9;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .bot-message {
            background-color: #ffffff;
            color: #1f2937;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #9ca3af;
            animation: bounce 1.3s infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
    </style>
</head>
<body class="flex h-screen">

    <!-- Sidebar -->
    <aside class="w-64 sidebar text-white flex flex-col flex-shrink-0">
        <div class="p-6 text-center border-b border-white/20">
            <h1 class="text-2xl font-bold">TimeTable Genius</h1>
        </div>
        <nav class="flex-1 px-4 py-6 space-y-2">
            <a href="student-dashboard.html" class="flex items-center px-4 py-2.5 text-white/80 hover:bg-white/10 rounded-lg">
                <i class="fas fa-home w-6 h-6 mr-3"></i> Dashboard
            </a>
            <a href="student-ai-assistant.html" class="flex items-center px-4 py-2.5 text-white bg-white/20 rounded-lg font-semibold">
                <i class="fas fa-robot w-6 h-6 mr-3"></i> AI Assistant
            </a>
            <a href="student-cloud-resources.html" class="flex items-center px-4 py-2.5 text-white/80 hover:bg-white/10 rounded-lg">
                <i class="fas fa-cloud w-6 h-6 mr-3"></i> Cloud Resources
            </a>
            <a href="student-quizzes.html" class="flex items-center px-4 py-2.5 text-white/80 hover:bg-white/10 rounded-lg">
                <i class="fas fa-graduation-cap w-6 h-6 mr-3"></i> Quizzes
            </a>
            <a href="#" class="flex items-center px-4 py-2.5 text-white/80 hover:bg-white/10 rounded-lg">
                <i class="fas fa-calendar-alt w-6 h-6 mr-3"></i> My Timetable
            </a>
        </nav>
        <div class="p-4 border-t border-white/20">
            <a href="login.html" class="flex items-center px-4 py-2.5 text-white/80 hover:bg-white/10 rounded-lg">
                <i class="fas fa-sign-out-alt w-6 h-6 mr-3"></i> Logout
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col p-8 overflow-hidden">
        <header class="mb-6">
            <h2 class="text-3xl font-bold text-white">AI Academic Assistant</h2>
            <p class="text-purple-200">Ask about your schedule or find study materials instantly.</p>
        </header>

        <div class="flex-1 bg-white/90 rounded-2xl shadow-2xl flex flex-col overflow-hidden">
            <div id="chat-messages" class="flex-1 p-6 overflow-y-auto flex flex-col space-y-4">
                <!-- Initial Bot Message -->
                <div class="chat-message bot-message">
                    Hello! I'm your academic assistant. You can ask "What is my next lecture?" or "Find me notes for Quantum Physics". How can I help?
                </div>
            </div>
            <div class="p-4 bg-white border-t-2 border-gray-100">
                <div class="flex items-center bg-gray-100 rounded-lg p-2">
                    <input type="text" id="chat-input" class="w-full bg-transparent px-3 py-2 text-gray-700 focus:outline-none" placeholder="Ask a question...">
                    <button id="chat-send" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 font-bold transition-colors">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');

        const mockCloudFiles = [
            { name: 'Quantum-Physics-Notes-Sem3.pdf', subject: 'Physics', type: 'notes' },
            { name: 'Organic-Chemistry-Reactions.pdf', subject: 'Chemistry', type: 'notes' },
            { name: 'PYQ-Physics-2023.pdf', subject: 'Physics', type: 'pyq' },
            { name: 'Thermodynamics-Summary.docx', subject: 'Physics', type: 'notes' },
        ];
        
        // Mock timetable data for the chatbot. Day is 1-7 (Mon-Sun)
        const timetableData = [
            { day: 3, time: '09:00', subject: 'Data Structures', location: 'CR-101' },
            { day: 3, time: '10:00', subject: 'Operating Systems', location: 'CR-203' },
            { day: 3, time: '11:00', subject: 'Quantum Physics', location: 'LAB-PH-02' },
            { day: 3, time: '14:00', subject: 'Database Systems', location: 'CR-101' },
        ];

        chatSend.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });

        function sendMessage() {
            const messageText = chatInput.value.trim();
            if (messageText === '') return;
            appendMessage(messageText, 'user');
            chatInput.value = '';
            showTypingIndicator();
            setTimeout(() => {
                const botResponse = generateBotResponse(messageText);
                hideTypingIndicator();
                appendMessage(botResponse, 'bot', true);
            }, 1800);
        }
        
        function appendMessage(text, sender, isHtml = false) {
             const messageElement = document.createElement('div');
             messageElement.className = `chat-message ${sender}-message`;
             if (isHtml) {
                 messageElement.innerHTML = text;
             } else {
                 messageElement.textContent = text;
             }
             chatMessages.appendChild(messageElement);
             chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        let typingIndicator;
        function showTypingIndicator() {
            typingIndicator = document.createElement('div');
            typingIndicator.className = 'chat-message bot-message typing-indicator';
            typingIndicator.innerHTML = '<span></span><span></span><span></span>';
            chatMessages.appendChild(typingIndicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            if(typingIndicator) chatMessages.removeChild(typingIndicator);
        }

        function generateBotResponse(userInput) {
            const lowerInput = userInput.toLowerCase();

            // 1. Check for schedule-related questions
            if (lowerInput.includes("next lecture") || lowerInput.includes("next period") || lowerInput.includes("what's next")) {
                const now = new Date('2025-09-17T09:26:00'); // Simulating current time: Wednesday 9:26 AM
                const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                const currentDay = now.getDay(); // Wednesday is 3

                let nextLecture = null;
                for (const lecture of timetableData) {
                    if (lecture.day === currentDay && lecture.time > currentTime) {
                        nextLecture = lecture;
                        break;
                    }
                }
                if (nextLecture) {
                    return `Your next lecture is '<strong>${nextLecture.subject}</strong>' at <strong>${formatTime(nextLecture.time)}</strong> in room <strong>${nextLecture.location}</strong>.`;
                } else {
                    return "You have no more lectures scheduled for today.";
                }
            }

            // 2. Check for resource-related questions
            const keywords = {
                physics: lowerInput.includes('physics'),
                chemistry: lowerInput.includes('chemistry'),
                notes: lowerInput.includes('note'),
                pyq: lowerInput.includes('pyq') || lowerInput.includes('question'),
            };

            if (keywords.physics || keywords.chemistry || keywords.notes || keywords.pyq) {
                 let foundFiles = mockCloudFiles.filter(file => {
                    const lowerFileName = file.name.toLowerCase();
                    if (keywords.physics && !lowerFileName.includes('physics')) return false;
                    if (keywords.chemistry && !lowerFileName.includes('chemistry')) return false;
                    if (keywords.notes && file.type !== 'notes') return false;
                    if (keywords.pyq && file.type !== 'pyq') return false;
                    return true;
                });
                if (foundFiles.length > 0) {
                    let responseHtml = `Sure! I found these files for you:<br><ul class="list-disc list-inside mt-2 space-y-1">`;
                    foundFiles.forEach(file => {
                        responseHtml += `<li><a href="#" class="text-purple-600 font-semibold hover:underline">${file.name}</a></li>`;
                    });
                    responseHtml += `</ul>`;
                    return responseHtml;
                } else {
                    return "I couldn't find any specific files for that. You can browse all available materials in the <a href='student-cloud-resources.html' class='text-purple-600 font-semibold'>Cloud Resources</a> section.";
                }
            }

            // 3. Default fallback response
            return "I can help with schedule questions like 'What's my next lecture?' or resource requests like 'Find chemistry notes'. How can I assist you?";
        }

        function formatTime(time) { // Converts '14:00' to '2:00 PM'
            const [hour, minute] = time.split(':');
            const hourNum = parseInt(hour);
            const ampm = hourNum >= 12 ? 'PM' : 'AM';
            const formattedHour = hourNum % 12 || 12;
            return `${formattedHour}:${minute} ${ampm}`;
        }
    </script>
</body>
</html>

